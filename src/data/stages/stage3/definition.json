{
  "id": "stage3_pirate",
  "name": "Pirate's Cove",
  "description": "An escape pod plunges into an ocean. On the island, someone is already waiting, wearing a captain's hat. They've commandeered a ghost ship.",

  "path": "both",

  "layout": {
    "archetypeId": "pirate_island",
    "levelOverrides": {
      "1": {
        "anchorRooms": [
          {
            "purpose": "lighthouse_base",
            "gridPosition": { "x": 1, "z": 1 },
            "templateId": "room_small",
            "templateTags": ["small", "island"],
            "storyBeats": ["lighthouse_climb"]
          },
          {
            "purpose": "lamp_room",
            "gridPosition": { "x": 1, "z": 2 },
            "templateId": "room_small",
            "templateTags": ["small", "island"],
            "isExit": true,
            "storyBeats": ["lighthouse_escape"]
          }
        ]
      },
      "0": {
        "totalRooms": { "min": 7, "max": 9 },
        "anchorRooms": [
          {
            "purpose": "beach",
            "gridPosition": { "x": 0, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["exterior_plaza", "island"],
            "isEntry": true,
            "storyBeats": ["wash_ashore"]
          },
          {
            "purpose": "dock",
            "gridPosition": { "x": -1, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["medium", "island"],
            "storyBeats": ["investigate_dock"],
            "questItems": ["captain_log"]
          },
          {
            "purpose": "jungle_path",
            "gridPosition": { "x": 0, "z": -1 },
            "templateId": "hallway_short",
            "templateTags": ["hallway", "island"],
            "storyBeats": ["jungle_bones"]
          },
          {
            "purpose": "cave",
            "gridPosition": { "x": 1, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "dark"],
            "storyBeats": ["cave_treasure"],
            "questItems": ["bone_necklace", "cursed_compass"]
          },
          {
            "purpose": "captain_quarters",
            "gridPosition": { "x": -1, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "ship"],
            "storyBeats": ["captain_diary"],
            "questItems": ["carl_flag"]
          },
          {
            "purpose": "crow_nest",
            "gridPosition": { "x": -1, "z": 1 },
            "templateId": "room_small",
            "templateTags": ["small", "ship"],
            "storyBeats": ["crow_nest_view"]
          },
          {
            "purpose": "lighthouse",
            "gridPosition": { "x": 1, "z": 1 },
            "templateId": "room_small",
            "templateTags": ["small", "island"],
            "storyBeats": ["lighthouse_approach"]
          }
        ]
      },
      "-1": {
        "anchorRooms": [
          {
            "purpose": "deep_cave",
            "gridPosition": { "x": 1, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "dark"],
            "storyBeats": ["deep_cave_horror"],
            "questItems": ["ancient_skull"]
          },
          {
            "purpose": "treasure_chamber",
            "gridPosition": { "x": 2, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "dark"],
            "storyBeats": ["treasure_discovery"]
          }
        ]
      }
    }
  },

  "story": {
    "beats": [
      {
        "id": "wash_ashore",
        "description": "Player arrives on a strange island. The other character is already there.",
        "dialogueId": "stage3_wash_ashore",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "beach" }
        },
        "consequences": {
          "nextBeat": "investigate_dock"
        }
      },
      {
        "id": "investigate_dock",
        "description": "A ghost ship is docked. The cargo is suspicious.",
        "dialogueId": "stage3_investigate_dock",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "dock" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "nextBeat": "jungle_bones",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "Welcome aboard the S.S. Carl! I commandeered it fair and square!",
                "The previous crew walked the plank. Voluntarily! Well, gravitationally.",
                "Paul, come see the cargo! I organized it by category AND freshness."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "That ship... it's covered in barnacles and what looks like dried blood.",
                "The cargo hold is open. Those crates aren't holding spices.",
                "Carl, where did you get a SHIP?"
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "find_captain_log",
        "description": "Find the captain's log detailing the ship's history",
        "dialogueId": "stage3_find_captain_log",
        "trigger": {
          "type": "item_pickup",
          "params": { "itemId": "captain_log" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "nextBeat": "cave_treasure"
        }
      },
      {
        "id": "jungle_bones",
        "description": "Bones used as trail markers in the jungle",
        "dialogueId": "stage3_jungle_bones",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "jungle_path" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "I made a nature trail! With organic, locally-sourced materials!",
                "Very sustainable. Very eco-friendly. Very crunchy underfoot.",
                "The femurs make excellent load-bearing structures, Paul."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "These trail markers... those aren't sticks. Those are BONES.",
                "Someone arranged them like arrows pointing deeper into the jungle.",
                "The craftsmanship is disturbingly familiar. Carl's work."
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "cave_treasure",
        "description": "Carl's treasure trove in the cave. It's not gold.",
        "dialogueId": "stage3_cave_treasure",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "cave" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "captain_diary",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "MY TREASURE ROOM! I've been collecting for MONTHS!",
                "Each piece is hand-curated. That necklace? Custom made!",
                "I call it 'artisanal.' Very exclusive. VERY limited edition."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "Carl's 'treasure.' Piled high in every corner.",
                "This isn't gold. This isn't treasure. This isâ€”",
                "I can't even describe what I'm looking at. I need to leave."
              ],
              "horrorLevelChange": 3
            }
          }
        }
      },
      {
        "id": "captain_diary",
        "description": "Find the diary in the captain's quarters on the ghost ship",
        "dialogueId": "stage3_captain_diary",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "captain_quarters" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "crow_nest_view",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "My captain's log! 'Day 47: The crew appreciated today's team-building exercise.'",
                "'Day 48: Crew size reduced for efficiency. Lean management!'",
                "Paul should read this. I think he'd appreciate my organizational skills."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "Carl's diary. Page after page of... recipes. 'Activities.' Plans.",
                "He's been at this longer than I thought. Much, much longer.",
                "There's a map here. X marks... oh no. There are so many Xs."
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "crow_nest_view",
        "description": "View from the crow's nest reveals the scope of destruction",
        "dialogueId": "stage3_crow_nest_view",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "crow_nest" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "unlockExits": ["lighthouse_path"],
          "nextBeat": "lighthouse_escape"
        }
      },
      {
        "id": "lighthouse_escape",
        "description": "Signal for rescue from the lighthouse",
        "dialogueId": "stage3_lighthouse_escape",
        "trigger": {
          "type": "reach_exit",
          "params": {}
        },
        "consequences": {
          "stageComplete": true
        }
      }
    ],
    "goals": [
      {
        "id": "explore_island",
        "character": "paul",
        "description": "Explore the island",
        "type": "reach_scene",
        "params": { "sceneId": "dock" },
        "priority": 0,
        "coupledGoalId": "show_paul_dock",
        "interferenceType": "racing"
      },
      {
        "id": "find_captain_log",
        "character": "paul",
        "description": "Find the captain's log",
        "type": "collect_items",
        "params": { "items": ["captain_log"] },
        "hiddenUntil": "investigate_dock",
        "priority": 1,
        "coupledGoalId": "hide_captain_log",
        "interferenceType": "racing",
        "onComplete": {
          "fireBeat": "find_captain_log"
        }
      },
      {
        "id": "investigate_cave",
        "character": "paul",
        "description": "Investigate the cave",
        "type": "reach_scene",
        "params": { "sceneId": "cave" },
        "hiddenUntil": "find_captain_log",
        "priority": 2,
        "coupledGoalId": "curate_treasure_cave",
        "interferenceType": "racing"
      },
      {
        "id": "search_ship",
        "character": "paul",
        "description": "Search the ghost ship",
        "type": "reach_scene",
        "params": { "sceneId": "captain_quarters" },
        "hiddenUntil": "cave_treasure",
        "priority": 3,
        "coupledGoalId": "guard_captain_quarters",
        "interferenceType": "racing"
      },
      {
        "id": "climb_crow_nest",
        "character": "paul",
        "description": "Climb to the crow's nest for a vantage point",
        "type": "reach_scene",
        "params": { "sceneId": "crow_nest" },
        "hiddenUntil": "captain_diary",
        "priority": 4,
        "coupledGoalId": "sabotage_lighthouse",
        "interferenceType": "racing"
      },
      {
        "id": "show_paul_dock",
        "character": "carl",
        "description": "Show Paul the S.S. Carl",
        "type": "reach_scene",
        "params": { "sceneId": "dock" },
        "priority": 0,
        "coupledGoalId": "explore_island",
        "interferenceType": "racing"
      },
      {
        "id": "hide_captain_log",
        "character": "carl",
        "description": "Hide the captain's log before Paul finds it",
        "type": "reach_scene",
        "params": { "sceneId": "dock" },
        "hiddenUntil": "investigate_dock",
        "priority": 1,
        "coupledGoalId": "find_captain_log",
        "interferenceType": "racing",
        "onComplete": {
          "relocateItem": { "itemId": "captain_log", "toRoom": "captain_quarters" }
        },
        "onFailed": {
          "fireBeat": "find_captain_log"
        }
      },
      {
        "id": "curate_treasure_cave",
        "character": "carl",
        "description": "Curate the treasure cave collection",
        "type": "reach_scene",
        "params": { "sceneId": "cave" },
        "hiddenUntil": "investigate_dock",
        "priority": 2,
        "coupledGoalId": "investigate_cave",
        "interferenceType": "enabling"
      },
      {
        "id": "finish_nature_trail",
        "character": "carl",
        "description": "Finish the nature trail installation",
        "type": "reach_scene",
        "params": { "sceneId": "jungle_path" },
        "hiddenUntil": "jungle_bones",
        "priority": 2
      },
      {
        "id": "guard_captain_quarters",
        "character": "carl",
        "description": "Guard the captain's quarters secrets",
        "type": "reach_scene",
        "params": { "sceneId": "captain_quarters" },
        "hiddenUntil": "cave_treasure",
        "priority": 3,
        "coupledGoalId": "search_ship",
        "interferenceType": "blocking"
      },
      {
        "id": "sabotage_lighthouse",
        "character": "carl",
        "description": "Sabotage the lighthouse path before Paul escapes",
        "type": "reach_scene",
        "params": { "sceneId": "lighthouse" },
        "hiddenUntil": "captain_diary",
        "priority": 4,
        "coupledGoalId": "climb_crow_nest",
        "interferenceType": "sabotaging",
        "onComplete": {
          "lockExit": "lighthouse_path"
        }
      },
      {
        "id": "escape_island",
        "description": "Complete this chapter",
        "type": "reach_exit",
        "params": {},
        "hiddenUntil": "crow_nest_view",
        "priority": 5
      }
    ],
    "startingBeat": "wash_ashore",
    "completionGoals": ["escape_island"]
  },

  "generation": {
    "entryScene": {
      "templateId": "room_medium",
      "templateTags": ["exterior_plaza", "island"],
      "purpose": "beach",
      "mustContain": {
        "features": ["rock", "barrel"]
      }
    },
    "exitScene": {
      "templateId": "room_small",
      "templateTags": ["small", "island"],
      "purpose": "lighthouse",
      "placement": {
        "distanceFromEntry": { "min": 3, "max": 5 }
      }
    },
    "requiredScenes": [
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "island"],
        "purpose": "dock"
      },
      {
        "templateId": "hallway_short",
        "templateTags": ["hallway", "island"],
        "purpose": "jungle_path"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "dark"],
        "purpose": "cave"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "ship"],
        "purpose": "captain_quarters"
      },
      {
        "templateId": "room_small",
        "templateTags": ["small", "ship"],
        "purpose": "crow_nest"
      }
    ],
    "optionalSceneCount": { "min": 1, "max": 2 },
    "allowedTemplates": [
      "room_small",
      "hallway_short"
    ],
    "palettes": ["island_tropical", "island_dark"],
    "connectionRules": {
      "type": "hub",
      "maxDeadEnds": 2,
      "loopsAllowed": false,
      "maxDistanceFromEntry": 4
    },
    "environment": "mixed",
    "separation": "open"
  },

  "props": {
    "density": "medium",
    "questItems": [
      {
        "id": "captain_log",
        "name": "Captain's Log",
        "description": "A leather-bound logbook with Paul's unmistakable hoofwriting",
        "pickupDialogue": "stage3_pickup_captain_log",
        "examineDialogue": "stage3_examine_captain_log",
        "spawnRules": {
          "sceneTypes": ["dock"],
          "zones": ["visible"]
        }
      },
      {
        "id": "bone_necklace",
        "name": "Bone Necklace",
        "description": "A necklace made from... definitely not shells",
        "pickupDialogue": "stage3_pickup_bone_necklace",
        "examineDialogue": "stage3_examine_bone_necklace",
        "spawnRules": {
          "sceneTypes": ["cave"],
          "zones": ["edge"],
          "requiredBeat": "cave_treasure"
        }
      },
      {
        "id": "cursed_compass",
        "name": "Cursed Compass",
        "description": "A compass that always points toward Paul. Always.",
        "pickupDialogue": "stage3_pickup_cursed_compass",
        "examineDialogue": "stage3_examine_cursed_compass",
        "spawnRules": {
          "sceneTypes": ["cave"],
          "zones": ["hidden"],
          "requiredBeat": "cave_treasure"
        }
      },
      {
        "id": "carl_flag",
        "name": "Carl's Jolly Roger",
        "description": "A pirate flag with Carl's face on it. The crossbones are disturbingly realistic.",
        "pickupDialogue": "stage3_pickup_carl_flag",
        "examineDialogue": "stage3_examine_carl_flag",
        "spawnRules": {
          "sceneTypes": ["captain_quarters"],
          "zones": ["visible"]
        }
      }
    ],
    "propPools": ["island_props", "pirate_props", "horror_props"]
  },

  "npcs": {
    "required": [
      {
        "characterId": "paul",
        "behavior": "idle",
        "dialogueId": "stage3_paul_dialogue",
        "interactable": true,
        "spawnRoom": "beach",
        "wanderRooms": ["beach", "dock", "captain_quarters"]
      }
    ],
    "optional": {
      "pool": [],
      "count": { "min": 0, "max": 0 }
    }
  },

  "atmosphere": {
    "baseHorrorLevel": 4,
    "horrorProgression": "increasing",
    "ambientSound": "ambient_ocean_waves",
    "musicTrack": "music_dark_theme",
    "perRoomOverrides": {
      "dock": {
        "horrorLevel": 5,
        "ambientSound": "ambient_ocean_waves"
      },
      "jungle_path": {
        "horrorLevel": 6,
        "ambientSound": "ambient_dripping"
      },
      "cave": {
        "horrorLevel": 8,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_gothic"
      },
      "captain_quarters": {
        "horrorLevel": 7,
        "musicTrack": "music_gothic"
      },
      "lighthouse": {
        "horrorLevel": 5,
        "musicTrack": "music_dark_theme"
      },
      "lighthouse_base": {
        "horrorLevel": 5,
        "musicTrack": "music_dark_theme"
      },
      "lamp_room": {
        "horrorLevel": 4,
        "musicTrack": "music_dark_theme"
      },
      "deep_cave": {
        "horrorLevel": 9,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_gothic"
      },
      "treasure_chamber": {
        "horrorLevel": 10,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_gothic"
      }
    }
  },

  "estimatedDuration": 15,
  "difficulty": "medium"
}
