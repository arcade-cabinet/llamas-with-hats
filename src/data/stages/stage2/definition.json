{
  "id": "stage2_space",
  "name": "The Space Station",
  "description": "The front door opens onto a docking bay. Someone has relocated the entire house into a space station. The crew is missing.",

  "path": "both",

  "layout": {
    "archetypeId": "space_station",
    "levelOverrides": {
      "1": {
        "anchorRooms": [
          {
            "purpose": "bridge",
            "gridPosition": { "x": 1, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["bridge_discovery"]
          },
          {
            "purpose": "observation_deck",
            "gridPosition": { "x": 2, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["observation_view"]
          }
        ]
      },
      "0": {
        "totalRooms": { "min": 7, "max": 9 },
        "anchorRooms": [
          {
            "purpose": "docking_bay",
            "gridPosition": { "x": 0, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["large", "station"],
            "isEntry": true,
            "storyBeats": ["arrive_station"],
            "questItems": ["crew_log"]
          },
          {
            "purpose": "corridor_a",
            "gridPosition": { "x": 1, "z": 0 },
            "templateId": "hallway_short",
            "templateTags": ["hallway", "station"],
            "storyBeats": ["flickering_corridor"]
          },
          {
            "purpose": "mess_hall",
            "gridPosition": { "x": 2, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["mess_hall_discovery"]
          },
          {
            "purpose": "crew_quarters",
            "gridPosition": { "x": 2, "z": 1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["crew_quarters_search"],
            "questItems": ["carl_mixtape"]
          },
          {
            "purpose": "medical_bay",
            "gridPosition": { "x": 3, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["medical_horror"],
            "questItems": ["medical_report"]
          },
          {
            "purpose": "engine_room",
            "gridPosition": { "x": 3, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["large", "station"],
            "storyBeats": ["engine_room_workshop"],
            "questItems": ["override_key"]
          },
          {
            "purpose": "airlock",
            "gridPosition": { "x": 4, "z": 0 },
            "templateId": "room_small",
            "templateTags": ["small", "station"],
            "isExit": true,
            "storyBeats": ["airlock_escape"]
          }
        ]
      },
      "-1": {
        "anchorRooms": [
          {
            "purpose": "cargo_hold",
            "gridPosition": { "x": 3, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["large", "station"],
            "storyBeats": ["cargo_hold_horror"]
          },
          {
            "purpose": "reactor_core",
            "gridPosition": { "x": 4, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "station"],
            "storyBeats": ["reactor_danger"]
          }
        ]
      }
    }
  },

  "story": {
    "beats": [
      {
        "id": "arrive_station",
        "description": "Player enters the space station docking bay",
        "dialogueId": "stage2_arrive_station",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "docking_bay" }
        },
        "consequences": {
          "nextBeat": "flickering_corridor"
        }
      },
      {
        "id": "flickering_corridor",
        "description": "The main corridor flickers with damaged lights. Drag marks on the floor.",
        "dialogueId": "stage2_flickering_corridor",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "corridor_a" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "nextBeat": "mess_hall_discovery"
        }
      },
      {
        "id": "mess_hall_discovery",
        "description": "The mess hall food is... suspicious",
        "dialogueId": "stage2_mess_hall",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "mess_hall" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "My gourmet space kitchen! I was the head chef, Paul!",
                "Zero gravity really helps the flavor profiles. Trust me.",
                "The secret ingredient is commitment. And also hands."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "This cafeteria... all the trays are still laid out. Meals half-eaten.",
                "The 'meat' in these portions doesn't look like any protein pack I've seen.",
                "Carl, what did you serve these people?"
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "crew_quarters_search",
        "description": "Empty bunks, personal effects, and Paul's mixtape",
        "dialogueId": "stage2_crew_quarters",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "crew_quarters" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "I made everyone personalized playlists! Very thoughtful.",
                "This one is labeled 'Last Dance.' Get it? Because of the dance party!",
                "Paul never appreciates my event planning."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "Fifty bunks. Every single one is empty. Personal items just... abandoned.",
                "Family photos, half-written letters home. They left in a hurry.",
                "Or they didn't leave at all. Carl, what did you do to these people?"
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "find_crew_log",
        "description": "Find the crew log detailing what happened",
        "dialogueId": "stage2_find_crew_log",
        "trigger": {
          "type": "item_pickup",
          "params": { "itemId": "crew_log" }
        },
        "consequences": {
          "horrorLevelChange": 1,
          "nextBeat": "medical_horror"
        }
      },
      {
        "id": "medical_horror",
        "description": "The medical bay reveals Carl's experiments",
        "dialogueId": "stage2_medical_horror",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "medical_bay" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "find_override_key",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "My science lab! I was conducting very important research!",
                "Did you know llama hooves are surprisingly dexterous with a scalpel?",
                "The crew volunteered! Well, they stopped objecting eventually."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "The surgical tools are... everywhere. Used. Repeatedly.",
                "These medical reports. 'Subject showed unexpected resilience.' Subject?!",
                "Carl performed surgery. On the crew. Without training. Without consent."
              ],
              "horrorLevelChange": 3
            }
          }
        }
      },
      {
        "id": "find_override_key",
        "description": "Find the airlock override key in the engine room",
        "dialogueId": "stage2_find_override_key",
        "trigger": {
          "type": "item_pickup",
          "params": { "itemId": "override_key" }
        },
        "consequences": {
          "unlockExits": ["airlock_door"],
          "nextBeat": "engine_room_workshop"
        }
      },
      {
        "id": "engine_room_workshop",
        "description": "Carl's workshop in the engine room, horror level 8",
        "dialogueId": "stage2_engine_room",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "engine_room" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "airlock_escape",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "Welcome to my art studio! In SPACE!",
                "I had a wonderful time in the engine room, Paul. The acoustics are perfect for screaming.",
                "I call this piece 'The Human Condition.' The materials are very authentic."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "The engine room. He's turned it into a workshop.",
                "These aren't spare parts. These are... oh god.",
                "Carl built things. From the crew. He built THINGS."
              ],
              "horrorLevelChange": 3
            }
          }
        }
      },
      {
        "id": "airlock_escape",
        "description": "Reach the airlock and escape the station",
        "dialogueId": "stage2_airlock_escape",
        "trigger": {
          "type": "reach_exit",
          "params": {}
        },
        "consequences": {
          "stageComplete": true,
          "nextStage": "stage3_pirate"
        }
      },
      {
        "id": "leave_medical",
        "description": "Leaving the medical bay - the horror lingers",
        "dialogueId": "stage2_leave_medical",
        "trigger": {
          "type": "scene_exit",
          "params": { "sceneId": "medical_bay" }
        },
        "consequences": {
          "horrorLevelChange": 1
        }
      }
    ],
    "goals": [
      {
        "id": "explore_station",
        "character": "paul",
        "description": "Explore the space station",
        "type": "reach_scene",
        "params": { "sceneId": "corridor_a" },
        "priority": 0,
        "coupledGoalId": "inspect_mess_hall",
        "interferenceType": "racing"
      },
      {
        "id": "find_crew_logs",
        "character": "paul",
        "description": "Find the crew logs",
        "type": "collect_items",
        "params": { "items": ["crew_log"] },
        "hiddenUntil": "flickering_corridor",
        "priority": 1
      },
      {
        "id": "search_medical",
        "character": "paul",
        "description": "Investigate the medical bay",
        "type": "reach_scene",
        "params": { "sceneId": "medical_bay" },
        "hiddenUntil": "find_crew_log",
        "priority": 2,
        "coupledGoalId": "setup_medical_lab",
        "interferenceType": "racing"
      },
      {
        "id": "find_key",
        "character": "paul",
        "description": "Find the airlock override key",
        "type": "collect_items",
        "params": { "items": ["override_key"] },
        "hiddenUntil": "medical_horror",
        "priority": 3,
        "coupledGoalId": "complete_engine_mobile",
        "interferenceType": "racing",
        "onComplete": {
          "fireBeat": "find_override_key"
        }
      },
      {
        "id": "inspect_mess_hall",
        "character": "carl",
        "description": "Visit the mess hall kitchen",
        "type": "reach_scene",
        "params": { "sceneId": "mess_hall" },
        "priority": 0,
        "coupledGoalId": "explore_station",
        "interferenceType": "racing"
      },
      {
        "id": "setup_medical_lab",
        "character": "carl",
        "description": "Check on the medical bay experiments",
        "type": "reach_scene",
        "params": { "sceneId": "medical_bay" },
        "hiddenUntil": "mess_hall_discovery",
        "priority": 1,
        "coupledGoalId": "search_medical",
        "interferenceType": "racing"
      },
      {
        "id": "complete_engine_mobile",
        "character": "carl",
        "description": "Finish the engine room art installation",
        "type": "reach_scene",
        "params": { "sceneId": "engine_room" },
        "hiddenUntil": "medical_horror",
        "priority": 2,
        "coupledGoalId": "find_key",
        "interferenceType": "sabotaging",
        "onComplete": {
          "lockExit": "airlock_door"
        }
      },
      {
        "id": "escape_station",
        "description": "Complete this chapter",
        "type": "reach_exit",
        "params": {},
        "hiddenUntil": "find_override_key",
        "priority": 4
      }
    ],
    "startingBeat": "arrive_station",
    "completionGoals": ["escape_station"]
  },

  "generation": {
    "entryScene": {
      "templateId": "room_medium",
      "templateTags": ["large", "station"],
      "purpose": "docking_bay",
      "mustContain": {
        "features": ["crate", "barrel"]
      }
    },
    "exitScene": {
      "templateId": "room_small",
      "templateTags": ["small", "station"],
      "purpose": "airlock",
      "placement": {
        "distanceFromEntry": { "min": 3, "max": 5 }
      }
    },
    "requiredScenes": [
      {
        "templateId": "hallway_short",
        "templateTags": ["hallway", "station"],
        "purpose": "corridor_a"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "station"],
        "purpose": "mess_hall"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "station"],
        "purpose": "crew_quarters"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["medium", "station"],
        "purpose": "medical_bay"
      },
      {
        "templateId": "room_medium",
        "templateTags": ["large", "station"],
        "purpose": "engine_room"
      }
    ],
    "optionalSceneCount": { "min": 1, "max": 2 },
    "allowedTemplates": [
      "room_small",
      "hallway_short",
      "closet"
    ],
    "palettes": ["station_sterile", "station_damaged"],
    "connectionRules": {
      "type": "linear",
      "maxDeadEnds": 2,
      "loopsAllowed": false,
      "maxDistanceFromEntry": 5
    },
    "environment": "interior",
    "separation": "wall_door"
  },

  "props": {
    "density": "medium",
    "questItems": [
      {
        "id": "crew_log",
        "name": "Crew Log Datapad",
        "description": "A cracked datapad with the last crew log entry still glowing",
        "pickupDialogue": "stage2_pickup_crew_log",
        "examineDialogue": "stage2_examine_crew_log",
        "spawnRules": {
          "sceneTypes": ["docking_bay"],
          "zones": ["visible"]
        }
      },
      {
        "id": "medical_report",
        "name": "Medical Report",
        "description": "A blood-spattered medical report detailing 'Patient Zero's activities'",
        "pickupDialogue": "stage2_pickup_medical_report",
        "examineDialogue": "stage2_examine_medical_report",
        "spawnRules": {
          "sceneTypes": ["medical_bay"],
          "zones": ["edge"],
          "requiredBeat": "medical_horror"
        }
      },
      {
        "id": "override_key",
        "name": "Airlock Override Key",
        "description": "A heavy metal key card labeled 'EMERGENCY AIRLOCK OVERRIDE'",
        "pickupDialogue": "stage2_pickup_override_key",
        "examineDialogue": "stage2_examine_override_key",
        "spawnRules": {
          "sceneTypes": ["engine_room"],
          "zones": ["hidden"],
          "requiredBeat": "medical_horror"
        }
      },
      {
        "id": "carl_mixtape",
        "name": "Carl's Greatest Hits",
        "description": "A data chip labeled 'Carl's Greatest Hits - DO NOT PLAY'",
        "pickupDialogue": "stage2_pickup_mixtape",
        "examineDialogue": "stage2_examine_mixtape",
        "spawnRules": {
          "sceneTypes": ["crew_quarters"],
          "zones": ["visible"]
        }
      }
    ],
    "propPools": ["station_furniture", "station_clutter", "horror_props"]
  },

  "npcs": {
    "required": [
      {
        "characterId": "paul",
        "behavior": "idle",
        "dialogueId": "stage2_paul_dialogue",
        "interactable": true,
        "spawnRoom": "docking_bay",
        "wanderRooms": ["docking_bay", "mess_hall", "engine_room"]
      }
    ],
    "optional": {
      "pool": [],
      "count": { "min": 0, "max": 0 }
    }
  },

  "atmosphere": {
    "baseHorrorLevel": 3,
    "horrorProgression": "increasing",
    "ambientSound": "ambient_station_hum",
    "musicTrack": "music_space_exploration",
    "perRoomOverrides": {
      "corridor_a": {
        "horrorLevel": 4,
        "ambientSound": "ambient_dripping"
      },
      "mess_hall": {
        "horrorLevel": 5,
        "ambientSound": "ambient_station_hum"
      },
      "medical_bay": {
        "horrorLevel": 7,
        "ambientSound": "ambient_dripping",
        "musicTrack": "music_space_tense"
      },
      "engine_room": {
        "horrorLevel": 8,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_space_boss"
      },
      "airlock": {
        "horrorLevel": 6,
        "musicTrack": "music_space_tense"
      },
      "bridge": {
        "horrorLevel": 5,
        "ambientSound": "ambient_station_hum",
        "musicTrack": "music_space_exploration"
      },
      "observation_deck": {
        "horrorLevel": 4,
        "ambientSound": "ambient_station_hum"
      },
      "cargo_hold": {
        "horrorLevel": 7,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_space_tense"
      },
      "reactor_core": {
        "horrorLevel": 9,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_space_boss"
      }
    }
  },

  "estimatedDuration": 15,
  "difficulty": "medium"
}
