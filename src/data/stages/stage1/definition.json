{
  "id": "stage1_house",
  "name": "The Morning After",
  "description": "Someone wakes up to find something terrible has happened in their house. Again.",

  "path": "both",

  "layout": {
    "archetypeId": "house_two_story",
    "levelOverrides": {
      "0": {
        "totalRooms": { "min": 6, "max": 8 },
        "anchorRooms": [
          {
            "purpose": "entry_hall",
            "gridPosition": { "x": 0, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["hallway", "house"],
            "isEntry": true,
            "storyBeats": ["wake_up"],
            "questItems": ["bloody_note"]
          },
          {
            "purpose": "living_room",
            "gridPosition": { "x": -1, "z": 0 },
            "templateId": "room_medium",
            "templateTags": ["living_room", "house"]
          },
          {
            "purpose": "kitchen",
            "gridPosition": { "x": 1, "z": 0 },
            "templateId": "room_kitchen",
            "templateTags": ["kitchen", "house"],
            "storyBeats": ["discover_blood"]
          },
          {
            "purpose": "dining_room",
            "gridPosition": { "x": 0, "z": -1 },
            "templateId": "room_medium",
            "templateTags": ["medium", "house"]
          }
        ]
      },
      "1": {
        "totalRooms": { "min": 3, "max": 5 },
        "anchorRooms": [
          {
            "purpose": "upstairs_hall",
            "gridPosition": { "x": 0, "z": 1 },
            "templateTags": ["hallway", "house"]
          },
          {
            "purpose": "master_bedroom",
            "gridPosition": { "x": -1, "z": 1 },
            "templateId": "room_bedroom",
            "templateTags": ["bedroom", "house"],
            "storyBeats": ["search_bedroom"],
            "questItems": ["basement_key"]
          },
          {
            "purpose": "bathroom",
            "gridPosition": { "x": 1, "z": 1 },
            "templateId": "room_bathroom",
            "templateTags": ["bathroom", "house"],
            "storyBeats": ["bathroom_mirror"]
          }
        ]
      },
      "-1": {
        "totalRooms": { "min": 2, "max": 3 },
        "anchorRooms": [
          {
            "purpose": "basement_main",
            "gridPosition": { "x": 1, "z": -1 },
            "templateId": "room_basement",
            "templateTags": ["basement", "dark"],
            "isExit": true,
            "storyBeats": ["discover_horror", "escape"]
          },
          {
            "purpose": "basement_storage",
            "gridPosition": { "x": 2, "z": -1 },
            "templateTags": ["storage", "dark"],
            "questItems": ["carl_journal"]
          }
        ]
      }
    }
  },

  "story": {
    "beats": [
      {
        "id": "wake_up",
        "description": "Player wakes up in the entry hall of the house",
        "dialogueId": "stage1_wake_up",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "entry_hall" }
        },
        "consequences": {
          "nextBeat": "explore_house"
        }
      },
      {
        "id": "explore_house",
        "description": "Player explores the house freely",
        "dialogueId": "stage1_explore",
        "trigger": {
          "type": "scene_exit",
          "params": { "sceneId": "entry_hall" }
        },
        "consequences": {
          "nextBeat": "discover_blood"
        }
      },
      {
        "id": "search_bedroom",
        "description": "Player searches the master bedroom and finds signs of struggle",
        "dialogueId": "stage1_bedroom_search",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "master_bedroom" }
        },
        "consequences": {
          "horrorLevelChange": 1
        }
      },
      {
        "id": "bathroom_mirror",
        "description": "Player finds a message written in the foggy mirror",
        "dialogueId": "stage1_bathroom_mirror",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "bathroom" }
        },
        "consequences": {
          "horrorLevelChange": 1
        }
      },
      {
        "id": "discover_blood",
        "description": "Player finds blood in the kitchen",
        "dialogueId": "stage1_blood_discovery",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "kitchen" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "find_key",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "My cranberry sauce experiment! The viscosity is PERFECT.",
                "I tried a new technique. Gravity-assisted reduction, Carl style.",
                "Paul's going to flip when he sees the kitchen. In a good way."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "This is... this is definitely blood. Carl has been busy again.",
                "The splatter pattern suggests something was dragged across the floor.",
                "I need to document this. Methodically. Before Carl destroys the evidence."
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "find_key",
        "description": "Player finds the basement key hidden in the master bedroom",
        "dialogueId": "stage1_pickup_key",
        "trigger": {
          "type": "item_pickup",
          "params": { "itemId": "basement_key" }
        },
        "consequences": {
          "unlockExits": ["basement_door"],
          "nextBeat": "basement_descent"
        }
      },
      {
        "id": "basement_descent",
        "description": "Player unlocks and descends into the basement",
        "dialogueId": "stage1_enter_basement",
        "trigger": {
          "type": "scene_enter",
          "params": { "sceneId": "basement_main" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "discover_horror",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "Welcome to my art studio! I've been working down here for WEEKS.",
                "The acoustics are perfect for creative expression.",
                "Wait until Paul sees the centerpiece. He's going to lose it."
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "The stairs creak under my weight. Each step feels like a mistake.",
                "The air down here is thick. Carl has been doing something terrible.",
                "I have to keep going. I need evidence of what he's done."
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "discover_horror",
        "description": "Player discovers what Carl has been hiding in the basement",
        "dialogueId": "stage1_discover_horror",
        "trigger": {
          "type": "interact",
          "params": { "targetId": "basement_evidence" }
        },
        "consequences": {
          "horrorLevelChange": 2,
          "nextBeat": "escape",
          "characterPathVariants": {
            "chaos": {
              "dialogue": [
                "Ta-da! My basement gallery! What do you think?",
                "I've been curating this for weeks. The symmetry is important.",
                "Paul? Paul, where are you going? You haven't seen the best part!"
              ],
              "horrorLevelChange": 1
            },
            "order": {
              "dialogue": [
                "No. No, no, no. This can't be real.",
                "Carl... what have you done? These are... these are people.",
                "I need to get out. I need to call someone. Anyone."
              ],
              "horrorLevelChange": 2
            }
          }
        }
      },
      {
        "id": "escape",
        "description": "Player must escape the house",
        "dialogueId": "stage1_escape",
        "trigger": {
          "type": "reach_exit",
          "params": {}
        },
        "consequences": {
          "stageComplete": true,
          "nextStage": "stage2_space"
        }
      }
    ],
    "goals": [
      {
        "id": "investigate_house",
        "character": "paul",
        "description": "Look around the house",
        "type": "reach_scene",
        "params": { "sceneId": "kitchen" },
        "priority": 0,
        "coupledGoalId": "check_kitchen_masterpiece",
        "interferenceType": "racing"
      },
      {
        "id": "search_rooms",
        "character": "paul",
        "description": "Search every room",
        "type": "visit_scenes",
        "params": { "scenes": ["master_bedroom", "bathroom", "kitchen"] },
        "hiddenUntil": "explore_house",
        "priority": 1
      },
      {
        "id": "find_basement_key",
        "character": "paul",
        "description": "Find the basement key",
        "type": "collect_items",
        "params": { "items": ["basement_key"] },
        "hiddenUntil": "discover_blood",
        "priority": 2,
        "coupledGoalId": "hide_basement_key",
        "interferenceType": "racing",
        "onComplete": {
          "fireBeat": "find_key"
        }
      },
      {
        "id": "enter_basement",
        "character": "paul",
        "description": "Descend into the basement",
        "type": "reach_scene",
        "params": { "sceneId": "basement_main" },
        "hiddenUntil": "find_key",
        "priority": 3,
        "coupledGoalId": "prepare_gallery",
        "interferenceType": "enabling"
      },
      {
        "id": "discover_truth",
        "character": "paul",
        "description": "Discover the truth",
        "type": "interact",
        "params": { "targetId": "basement_evidence" },
        "hiddenUntil": "basement_descent",
        "priority": 4,
        "coupledGoalId": "show_paul_the_art",
        "interferenceType": "racing"
      },
      {
        "id": "check_kitchen_masterpiece",
        "character": "carl",
        "description": "Check on the kitchen experiment",
        "type": "reach_scene",
        "params": { "sceneId": "kitchen" },
        "priority": 0,
        "coupledGoalId": "investigate_house",
        "interferenceType": "racing"
      },
      {
        "id": "hide_basement_key",
        "character": "carl",
        "description": "Hide the basement key somewhere harder to find",
        "type": "reach_scene",
        "params": { "sceneId": "master_bedroom" },
        "hiddenUntil": "discover_blood",
        "priority": 1,
        "coupledGoalId": "find_basement_key",
        "interferenceType": "racing",
        "onComplete": {
          "relocateItem": { "itemId": "basement_key", "toRoom": "bathroom" }
        },
        "onFailed": {
          "fireBeat": "find_key"
        }
      },
      {
        "id": "prepare_gallery",
        "character": "carl",
        "description": "Prepare the basement gallery",
        "type": "reach_scene",
        "params": { "sceneId": "basement_main" },
        "hiddenUntil": "discover_blood",
        "priority": 2,
        "coupledGoalId": "enter_basement",
        "interferenceType": "enabling"
      },
      {
        "id": "show_paul_the_art",
        "character": "carl",
        "description": "Show Paul your basement masterpiece",
        "type": "interact",
        "params": { "targetId": "basement_evidence" },
        "hiddenUntil": "basement_descent",
        "priority": 3,
        "coupledGoalId": "discover_truth",
        "interferenceType": "racing"
      },
      {
        "id": "escape_house",
        "description": "Complete this chapter",
        "type": "reach_exit",
        "params": {},
        "hiddenUntil": "discover_horror",
        "priority": 5
      }
    ],
    "startingBeat": "wake_up",
    "completionGoals": ["escape_house"]
  },

  "generation": {
    "entryScene": {
      "templateId": "room_medium",
      "templateTags": ["hallway", "house"],
      "purpose": "entry_hall",
      "mustContain": {
        "features": ["couch", "table"]
      }
    },
    "exitScene": {
      "templateId": "room_basement",
      "templateTags": ["basement", "dark"],
      "purpose": "exit",
      "placement": {
        "distanceFromEntry": { "min": 3, "max": 5 }
      }
    },
    "requiredScenes": [
      {
        "templateId": "room_medium",
        "templateTags": ["living_room", "house"],
        "purpose": "living_room"
      },
      {
        "templateId": "room_kitchen",
        "templateTags": ["kitchen", "house"],
        "purpose": "kitchen",
        "mustContain": {
          "features": ["sink", "counter"]
        }
      },
      {
        "templateId": "room_bedroom",
        "templateTags": ["bedroom", "house"],
        "purpose": "master_bedroom"
      },
      {
        "templateId": "room_bathroom",
        "templateTags": ["bathroom", "house"],
        "purpose": "bathroom"
      }
    ],
    "optionalSceneCount": { "min": 1, "max": 3 },

    "allowedTemplates": [
      "room_small",
      "room_medium",
      "hallway_short",
      "closet"
    ],

    "palettes": ["house_worn", "house_dark"],

    "connectionRules": {
      "type": "branching",
      "maxDeadEnds": 2,
      "loopsAllowed": false,
      "maxDistanceFromEntry": 5
    },

    "environment": "interior",
    "separation": "wall_door"
  },

  "props": {
    "density": "cluttered",
    "questItems": [
      {
        "id": "basement_key",
        "name": "Rusty Key",
        "description": "An old key with a tag that says 'BASEMENT'",
        "pickupDialogue": "stage1_pickup_key",
        "examineDialogue": "stage1_examine_key",
        "spawnRules": {
          "sceneTypes": ["master_bedroom"],
          "zones": ["hidden"],
          "requiredBeat": "discover_blood"
        }
      },
      {
        "id": "bloody_note",
        "name": "Blood-Stained Note",
        "description": "A crumpled note with something written on it",
        "pickupDialogue": "stage1_read_note",
        "examineDialogue": "stage1_examine_note",
        "spawnRules": {
          "sceneTypes": ["entry_hall"],
          "zones": ["visible"]
        }
      },
      {
        "id": "carl_journal",
        "name": "Carl's Journal",
        "description": "A leather-bound notebook with Carl's handwriting",
        "pickupDialogue": "stage1_read_journal",
        "examineDialogue": "stage1_examine_journal",
        "spawnRules": {
          "sceneTypes": ["basement_storage"],
          "zones": ["hidden"],
          "requiredBeat": "basement_descent"
        }
      },
      {
        "id": "broken_phone",
        "name": "Broken Phone",
        "description": "A smashed phone with one unsent text message",
        "pickupDialogue": "stage1_find_phone",
        "examineDialogue": "stage1_examine_phone",
        "spawnRules": {
          "sceneTypes": ["master_bedroom", "kitchen"],
          "zones": ["edge"]
        }
      }
    ],
    "propPools": ["house_furniture", "house_clutter", "horror_props"]
  },

  "npcs": {
    "required": [
      {
        "characterId": "paul",
        "behavior": "idle",
        "dialogueId": "stage1_paul_dialogue",
        "interactable": true,
        "spawnRoom": "entry_hall",
        "wanderRooms": ["entry_hall", "kitchen", "living_room"]
      }
    ],
    "optional": {
      "pool": [],
      "count": { "min": 0, "max": 0 }
    }
  },

  "atmosphere": {
    "baseHorrorLevel": 1,
    "horrorProgression": "increasing",
    "ambientSound": "ambient_house_morning",
    "musicTrack": "music_uneasy",
    "perRoomOverrides": {
      "kitchen": {
        "horrorLevel": 3,
        "ambientSound": "ambient_dripping"
      },
      "basement_main": {
        "horrorLevel": 7,
        "ambientSound": "ambient_basement_drip",
        "musicTrack": "music_horror_discovery"
      },
      "basement_storage": {
        "horrorLevel": 5,
        "ambientSound": "ambient_basement_drip"
      }
    }
  },

  "estimatedDuration": 15,
  "difficulty": "easy"
}
